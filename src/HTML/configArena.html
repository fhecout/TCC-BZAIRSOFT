<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Configura√ß√£o de Hor√°rios Di√°rios</title>

    <link rel="stylesheet" href="../css/style-configArena.css">
    <link rel="stylesheet" href="../css/variables.css">
    <link rel="stylesheet" href="../css/reset.css">

</head>

<body>
    <header>
        <a href="../HTML/login.html">
            <img src="../images/Logo.png" alt="Logo">
        </a>
    </header>
    
    <h1>Configura√ß√£o de Hor√°rios Di√°rios</h1>
    <p>Defina os hor√°rios que ser√£o adicionados automaticamente ao sistema todos os dias.</p>
    <div id="horarios-container">
        <table>
            <thead>
                <tr>
                    <th>Hor√°rio</th>
                </tr>
            </thead>
            <tbody>
                <!-- As linhas de hor√°rio ser√£o inseridas aqui -->
            </tbody>
        </table>
    </div>
    <button onclick="adicionarLinhaHorario()">Adicionar Novo Hor√°rio</button>

    <script>
        // Fun√ß√£o para adicionar uma nova linha de hor√°rio
        function adicionarLinhaHorario(horario = '', id = null) {
            const tbody = document.querySelector('#horarios-container tbody');
            const tr = document.createElement('tr');
            tr.className = 'horario-linha';
            tr.dataset.id = id; // Armazena o ID no elemento para uso posterior
            tr.innerHTML = `
    <td><input type="time" class="horario-input" value="${horario}" ${id ? 'disabled' : ''}></td>
    <td><button onclick="removerLinhaHorario(this, ${id})">üóëÔ∏è</button></td>
  `;
            if (!id) { // Se n√£o tiver ID, estamos criando um novo hor√°rio
                const input = tr.querySelector('.horario-input');
                input.addEventListener('change', () => salvarHorario(input.value));
            }
            tbody.appendChild(tr);
        }

        // Fun√ß√£o para salvar um novo hor√°rio no banco de dados
        async function salvarHorario(horario) {
            const response = await fetch('/HorarioDiario', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ horario }),
            });

            if (response.ok) {
                // Recarrega os hor√°rios ap√≥s adicionar um novo
                carregarHorarios();
            } else {
                console.error('Erro ao salvar o hor√°rio');
            }
        }

        // Fun√ß√£o para remover uma linha de hor√°rio
        async function removerLinhaHorario(button, id) {
            if (id) {
                const response = await fetch(`/HorarioDiario/${id}`, {
                    method: 'DELETE',
                });

                if (response.ok) {
                    button.closest('tr').remove();
                } else {
                    console.error('Erro ao remover o hor√°rio');
                }
            } else {
                button.closest('tr').remove();
            }
        }

        // Fun√ß√£o para carregar hor√°rios existentes
        async function carregarHorarios() {
            const response = await fetch('/HorarioDiario');
            const horarios = await response.json();
            const tbody = document.querySelector('#horarios-container tbody');
            tbody.innerHTML = ''; // Limpa a tabela antes de recarregar os hor√°rios
            horarios.forEach(horario => adicionarLinhaHorario(horario.horario, horario.id));
        }

        // Chamada inicial para carregar hor√°rios
        carregarHorarios();

    </script>
</body>

</html>